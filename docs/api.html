<!DOCTYPE HTML>
<html>
<head>
<style type="text/css">
.code {
	padding:1em;
	border:1px solid #000;
	font-family:monospace;
	white-space:pre;
}
</style>
<body>
<a name="0toc"><h1>0. Table of Contents</h1></a>
<ul>
<li><a href="#1introduction">1. Introduction</a></li>
<li><a href="#2summary">2. API summary and document structure</a></li>
<li><a href="#3blitwiz.graphics">3. <i>blitwiz.graphics</i> namespace</a></li>
<li><a href="#4blitwiz.on_*">4. Event callbacks</a></li>
<li><a href="#5os">5. <i>os</i> standard namespace extension</a></li>
<li><a href="#6string">6. <i>string</i> standard namespace extension</a></li>
</ul>
<a name="1introduction"><h1>1. Introduction</h1></a>
<p>This document describes the blitwizard Lua api with all provided functions.
Since blitwizard is intended for use with Lua 5 (which it includes),
those are mainly the functions you will use to program your games.</p>
<p>Event callbacks are also listed in the <a href="">event section</a>.</p>
<p>If this document refers to namespaces, this actually means the Lua tables in
the global space that hold sub functions and variables conveniently packed into
common modules, e.g. the string table or the os table of the standard lib.</p>
<a name="2summary"><h1>2. API summary and document structure</h1></a>
<p>
Blitwizard mainly comes with an own blitwiz namespace, but also extends the Lua 5
standard library which it contains. The Lua 5 standard functions are <b>not</b> described
here but nevertheless important for using Lua, so
<a href="http://www.lua.org/manual/5.1/manual.html#5">take a look at Lua's standard lib reference</a>
if you aren't familiar with them.</p>
<p>The blitwizard extensions to the standard library however, consisting of additional
functions added to the Lua 5 standard namespaces,
e.g. <a href="#5string">additional string functions</a>, are described in this document.</p>
<p>All functions listed in this document are listed with their names, parameters and return value,
whereas a parameter type and return value type
is specified.
Of course Lua allows you to specify variables of any type as parameter,
but most functions will error if you submit an unfitting type.
The types are specified
in brackets behind the parameters like this: <i>(number)</i>. The return value is
described in the more lengthy description which
follows each listed function.</p>
<p>Those types refer to standard Lua 5 variable types: <i>number, string, boolean, nil</i></p>
<p>The Lua 5 of blitwizard is mostly compiled with standard settings, e.g. numbers
being double 64bit floating point numbers. Null bytes in strings are generally not
supported by functions in the blitwiz namespace (those will cut the string off at the
first null byte), while all extension functions put into the standard namespaces (like
the string functions) can deal with null bytes similar to Lua's own internal string
functions.</p>
<a name="3blitwiz.graphics"><h1>3. <i>blitwiz.graphics</i> namespace</h1></a>
<ul>

<li><h2><a name="blitwiz.graphics.drawImage">blitwiz.graphics.drawImage</a>(filename <i>(string)</i>, x position <i>(number)</i>, y position <i>(number)</i>, alpha <i>(number)</i>)</h2>
<p>
Draw a fully loaded image (see <a href="#blitwiz.graphics.loadImage">blitwiz.graphics.loadImage</a> and <a href="#blitwiz.on_image">on_image</a>).
Throws an error if the image isn't fully loaded.
Don't use this call anywhere else than from inside <a href="#blitwiz.on_draw">on_draw</a>.
</p>
<p>Currently supported file formats: PNG (.png)</p>
<p>
Parameters:
<ul>
<li>filename <i>(string)</i> &mdash; specify the filename/path of the loaded image</li>
<li>x position <i>(number)</i> &mdash; horizontal position in pixels (0 is left, positive goes right) on the screen, negative coordinates are also allowed (image will be blitted partly or fully moved out of the screen)</li>
<li>y position <i>(number)</i> &mdash; vertical position in pixels (0 is top, positive goes downwards) on the screen, negative coordinates possible (see above)</li>
<li>alpha <i>(number, optional)</i> &mdash; alpha transparency in the range 0..1, with 0 being completely invisible and 1 fully opaque. default is 1</li>
</ul>
</p>
<p>
Return value: <i>nil</i> &mdash; none
</p>
<p>
Examples:
<div class="code">-- Draw an image at position 5,5 into the currently opened output window
blitwiz.graphics.drawImage("mypicture.png", 5, 5)

-- Draw the image again moved to the right with only 75% visibility (slightly transparent):
blitwiz.graphics.drawImage("mypicture.png", 150, 5, 0.75)
</div>
<p>
</li>

<li><h2><a name="blitwiz.graphics.getImageSize">blitwiz.graphics.getImageSize</a>(filename <i>(string)</i>)</h2>
<p>
Returns the size of a fully loaded image (see <a href="#blitwiz.graphics.loadImage">blitwiz.graphics.loadImage</a> and <a href="#blitwiz.on_image">on_image</a>).
Throws an error if the image isn't fully loaded.
</p>
<p>
Parameters:
<ul>
<li>filename <i>(string)</i> &mdash; specify the filename/path of the loaded image</li>
</ul>
</p>
<p>
Return values: image width <i>(number)</i>, image height <i>(number)</i>
</p>
<p>
Example:
<div class="code">-- Output the size of an image
local w,h = blitwiz.graphics.getImageSize("mypicture.png")
print("The size of mypicture.png is: " .. tostring(w) .. "," .. tostring(h))
</div>
</p>
</li>

<li><h2><a name="blitwiz.graphics.getWindowSize">blitwiz.graphics.getWindowSize</a>()</h2>
<p>
Returns the size of the currently open window (see <a href="#blitwiz.graphics.setWindow">blitwiz.graphics.setWindow</a>).
Throws an error if no window is open.
</p>
<p>
Parameters: None
</p>
<p>
Return values: window width <i>(number)</i>, window height <i>(number)</i>
</p>
</li>

<li><h2><a name="blitwiz.graphics.loadImage">blitwiz.graphics.loadImage</a>(filename <i>(string)</i>)</h2>
<p>
Prompt an image file for loading for use in drawing operations. This needs to be done
for any image you want to use with e.g. <a href="#blitwiz.graphics.drawImage">blitwiz.graphics.drawImage</a>
later.
</p>
<p>
Please note image loading is <b>not</b> processed immediately! Instead, image loading is done in the
background while the script execution and engine operation continues fully, and as soon as the image
loading process has finished, you'll get an <a href="#blitwiz.on_image">on_image</a> event call.
<p>
<p>Do not use any image for drawing before you got the on_image event with reported success! It will
yield an error.</p>
<p>Calling <a href="#blitwiz.graphics.loadImage">blitwiz.graphics.loadImage</a>
when the image is already being loaded simply does nothing. As soon as an
<a href="#blitwiz.on_image">on_image</a> event reports success, any further
calls attempting to load such an image will result in an error that the image
is already loaded.
If <a href="#blitwiz.on_image">on_image</a> reported failure, you can retry
<a href="#blitwiz.graphics.loadImage">blitwiz.graphics.loadImage</a> if you
think that will help.
<p>
Parameters:
<ul>
<li>filename <i>(string)</i> &mdash; specify the filename/path of the image</li>
</ul>
</p>
<p>
Return value: <i>nil</i> &mdash; none
</p>
<p>
Example:
<div class="code">-- Load an image:
blitwiz.graphics.loadImage("mypicture.png")

-- Here at this point, the image is NOT available for use yet, so drawing and all that will fail.
-- We need to wait for an <a href="#blitwiz.on_image">on_image</a> event first!
</div>
</p>
</li>

<li><h2><a name="blitwiz.graphics.setWindow">blitwiz.graphics.setWindow</a>(width <i>(number)</i>, height <i>(number)</i>, title<i>(string)</i>, fullscreen<i>(boolean)</i>, renderer<i>(string)</i>)</h2>
<p>
Open a new graphics output window, or change the settings for a currently opened
window in case there is one already opened.
You can also <i>close</i> the window by passing no parameters.
If there is a problem opening a window,
an error will be triggered.
</p>
<p></p>
<p>
You should expect errors for two cases: fullscreen windows with an unsupported
resolution (in such case, you could automatically retry with windowed mode), and driver issues
which make the renderer unable to startup.
Blitwizard mostly picks an accelerated renderer (either "direct3d" or "opengl")
per default, see renderer parameter below, so you can try to specify "software" as a fallback
in case of an error to see if that one works.
</p>
<p>
Texture loading is possible without any open window, and textures remain
available even if you call setWindow again or setWindow fails.
As soon as setWindow succeeds
in creating or changing a window, you will be able to use all previously loaded
textures instantly
without any further actions required.
</p>
<p>
Please note on a renderer change, this function call can take a few seconds of time
which it needs for transferring all the textures to the new renderer - it will block
and only return as soon as the renderer change is complete.
</p>
<p>
Parameters:
<ul>
<li>width <i>(number)</i> &mdash; specify the width (in pixels) of the output window</li>
<li>height <i>(number)</i> &mdash; specify the height (in pixels) of the output window</li>
<li>title <i>(string, optional)</i> &mdash; specify a window title for the title bar</li>
<li>fullscreen <i>(boolean, optional)</i> &mdash; specify if the window should be fullscreen (true) or not (false) - default is false</li>
<li>renderer <i>string</i> &mdash; specify a preferred renderer. this specifies the
backend blitwizard will use to output the graphics, which can be one of the following:
"software", "direct3d", "opengl". Please note that "direct3d" is only available on Windows systems!
<p>Generally you shouldn't force anything here, except if you want to allow the user to specify a
renderer explicitely or when setWindow fails with the default choice (which is different depending
on various things like the platform).
</p>
<p>
In such a case, make sure to call <a href="#os.systemname">os.systemname</a> and check for "windows"
before you offer or attempt to use direct3d.
</p>
</li>
</ul>
</p>
<p>
Example:
<div class="code">-- Attempt to run in fullscreen and open a window if that doesn't work

local function openwindowfullscreen()
	blitwiz.graphics.setWindow(800,600,"My Game",true)
end

-- Attempt fullscreen first
local success = pcall(openwindowfullscreen)
if success ~= true then
	-- Fallback to windowed mode
	blitwiz.graphics.setWindow(800,600,"My Game",false)
end
</div>
</p>
</li>

</ul>
<a name="4blitwiz.on_*"><h1>4. Event callbacks</h1></a>
<ul>

<li><h2><a name="blitwiz.on_draw">blitwiz.on_draw</a>()</h2>
<p>
If you define this function in your program in the global space, it will be called
each time blitwizard scheduled a redraw (this happens automatically many times in
a second, you don't have to do anything for it).
</p>
<p>Place all your <a href="#blitwiz.graphics.drawImage">blitwiz.graphics.drawImage</a>
calls into this function.</p>
<p>
Parameters:
<ul>
<li>texture name <i>(string)</i> &mdash; contains the texture path (which was originally
provided to <a href="#blitwiz.graphics.loadImage">blitwiz.graphics.loadImage</a>)</li>
<li>result <i>(boolean)</i> &mdash; indicates whether the image has been successfully loaded (in which case
it will be true), or failed to load (in which case it will be false)</li>
</ul>
</p>
<p>
Example:
<div class="code">--Print out the loading result of any loaded image
function blitwiz.on_image(texture, result)
	if result == true then
		print ("Image " .. texure .. " has been loaded and is now available for drawing.")
	else
		print ("Image " .. texture .. " failed to load!")
	end
end
</div>
</p>
</li>

<li><h2><a name="blitwiz.on_image">blitwiz.on_image</a>(texture name <i>(string)</i>, result <i>(boolean)</i>)</h2>
<p>
If you define this function in your program in the global space, it will be called
as soon as an image has either finished loading and is now available for drawing
operations, or if an image has failed loading and won't be available at all.
</p>
<p>
Parameters:
<ul>
<li>texture name <i>(string)</i> &mdash; contains the texture path (which was originally
provided to <a href="#blitwiz.graphics.loadImage">blitwiz.graphics.loadImage</a>)</li>
<li>result <i>(boolean)</i> &mdash; indicates whether the image has been successfully loaded (in which case
it will be true), or failed to load (in which case it will be false)</li>
</ul>
</p>
<p>
Example:
<div class="code">--Print out the loading result of any loaded image
function blitwiz.on_image(texture, result)
	if result == true then
		print ("Image " .. texure .. " has been loaded and is now available for drawing.")
	else
		print ("Image " .. texture .. " failed to load!")
	end
end
</div>
</p>
</li>

</ul>
<a name="5os"><h1>5. <i>os</i> standard namespace extension</h1></a>
<a name="6string"><h1>6. <i>string</i> standard namespace extension<h1></a>
</body>
</html>
